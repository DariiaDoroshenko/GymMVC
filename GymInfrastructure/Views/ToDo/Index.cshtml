@{
    ViewData["Title"] = "To-Do List";
}

<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js"></script>


<div class="container mt-4">
    <h2 class="text-center mb-4">План тренування</h2>

    <div class="input-group mb-3">
        <input type="text" id="todoInput" class="form-control" placeholder="Введіть нове завдання...">
        <button id="addBtn" class="btn btn-primary">Додати</button>
    </div>

    <ul id="todoList" class="list-group"></ul>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const todoList = document.getElementById("todoList");
        const todoInput = document.getElementById("todoInput");
        const addBtn = document.getElementById("addBtn");

        let todos = JSON.parse(localStorage.getItem("todos")) || [];

        function saveTodos() {
            localStorage.setItem("todos", JSON.stringify(todos));
        }

        function renderTodos() {
            todoList.innerHTML = "";
            todos.forEach((todo, index) => {
                const li = document.createElement("li");
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                li.draggable = true;
                li.dataset.index = index;

                li.innerHTML = `
                    <span>${todo}</span>
                    <button class="btn btn-danger btn-sm deleteBtn">✕</button>
                `;

                // Видалення
                li.querySelector(".deleteBtn").addEventListener("click", function () {
                    todos.splice(index, 1);
                    saveTodos();
                    renderTodos();
                });

                // Drag-and-drop події
                li.addEventListener("dragstart", dragStart);
                li.addEventListener("dragover", dragOver);
                li.addEventListener("drop", drop);
                li.addEventListener("dragend", dragEnd);

                todoList.appendChild(li);
            });
        }

        function dragStart(e) {
            e.target.classList.add("dragging");
            e.dataTransfer.setData("text/plain", e.target.dataset.index);
        }

        function dragOver(e) {
            e.preventDefault();
            const draggingItem = document.querySelector(".dragging");
            const currentItem = e.currentTarget;
            if (draggingItem === currentItem) return;

            const bounding = currentItem.getBoundingClientRect();
            const offset = e.clientY - bounding.top;
            const half = bounding.height / 2;

            if (offset > half) {
                currentItem.after(draggingItem);
            } else {
                currentItem.before(draggingItem);
            }
        }

        function drop(e) {
            e.preventDefault();
            const draggingItem = document.querySelector(".dragging");
            draggingItem.classList.remove("dragging");

            const newOrder = Array.from(todoList.children).map(li => li.querySelector("span").textContent);
            todos = newOrder;
            saveTodos();
            renderTodos();
        }

        function dragEnd(e) {
            e.target.classList.remove("dragging");
        }

        addBtn.addEventListener("click", function () {
            const text = todoInput.value.trim();
            if (text === "") return;
            todos.push(text);
            saveTodos();
            renderTodos();
            todoInput.value = "";
        });

        todoInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") addBtn.click();
        });

        renderTodos();
    });
        const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const todosRef = db.ref("todos");

    todosRef.on("value", (snapshot) => {
        const data = snapshot.val() || [];
        todos = data;
        renderTodos();
    });

    function saveTodos() {
        todosRef.set(todos);
    }

</script>


<style>
    
    #todoList li.dragging {
        opacity: 0.5;
        background-color: #cce5ff;
    }
</style>
