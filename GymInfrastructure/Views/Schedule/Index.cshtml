@model GymInfrastructure.ViewModels.ScheduleViewModel

@{
    ViewData["Title"] = "Розклад на тиждень";
}

<style>
    body {
        background-color: #0d0d0d;
        color: #f5f5f5;
        font-family: 'Poppins', sans-serif;
    }

    h2 {
        text-align: center;
        margin-bottom: 40px;
        color: #ff4500;
        font-weight: 700;
        letter-spacing: 1px;
    }

    /* ДАТИ (кнопки днів тижня) */
    #dates-bar {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 40px;
    }

    .date-btn {
        background-color: #1a1a1a;
        color: #f5f5f5;
        border: 1px solid #ff4500;
        border-radius: 12px;
        padding: 12px 20px;
        font-size: 1rem;
        transition: 0.3s;
    }

        .date-btn:hover {
            background-color: #ff4500;
            color: white;
            transform: translateY(-3px);
        }

    .btn-primary {
        background-color: #ff4500 !important;
        border-color: #ff4500 !important;
        color: white !important;
        box-shadow: 0 0 15px rgba(255, 69, 0, 0.5);
    }

    .btn-outline-secondary {
        background-color: #1a1a1a;
        color: #ccc;
        border: 1px solid #333;
    }

    /* КНОПКА додати тренування */
    #add-training-btn {
        display: block;
        margin: 0 auto 40px auto;
        background-color: #ff4500;
        color: white;
        font-weight: 600;
        padding: 12px 30px;
        border-radius: 30px;
        border: none;
        transition: 0.3s;
        text-align: center;
    }

        #add-training-btn:hover {
            background-color: #ff6622;
            transform: scale(1.05);
        }

    /* КАРТОЧКИ тренувань */
    #trainings-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 25px;
        padding: 20px;
    }

    .training-card {
        background-color: #1a1a1a;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 0 10px rgba(255, 69, 0, 0.3);
        transition: 0.3s;
    }

        .training-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 20px rgba(255, 69, 0, 0.6);
        }

        .training-card h5 {
            color: #ff4500;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .training-card p {
            color: #ccc;
        }

        .training-card .btn {
            border-radius: 20px;
            padding: 8px 20px;
            font-size: 0.9rem;
            transition: 0.3s;
        }

            .training-card .btn:hover {
                transform: scale(1.05);
            }

    .alert {
        background-color: #1a1a1a;
        border-left: 4px solid #ff4500;
        color: #f5f5f5;
        padding: 20px;
        text-align: center;
    }
</style>

<h2>Розклад на тиждень</h2>

<div class="mb-3">
    <div id="dates-bar">
        @foreach (var d in Model.Dates)
        {
            var isSelected = d == Model.SelectedDate ? "btn-primary" : "btn-outline-secondary";
            <button class="btn @isSelected date-btn" data-date="@d.ToString("yyyy-MM-dd")">
                <div>@d.ToString("dd.MM")</div>
                <small >@d.ToString("dddd", new System.Globalization.CultureInfo("uk-UA"))</small>
            </button>
        }
    </div>
</div>

@if (User.IsInRole("Trainer"))
{
    <a id="add-training-btn"
       href="@Url.Action("Create", "Schedule", new { date = Model.SelectedDate.ToString("yyyy-MM-dd") })">
        + Додати тренування
    </a>
}

<div id="trainings-container">
    @await Html.PartialAsync("_TrainingCards", Model.Trainings)
</div>

@section Scripts {
    <script>
        (function () {
            const container = document.getElementById('trainings-container');
            const dateButtons = document.querySelectorAll('.date-btn');

            function clearActive() {
                dateButtons.forEach(b => {
                    b.classList.remove('btn-primary');
                    b.classList.add('btn-outline-secondary');
                });
            }

            async function loadForDate(dateStr, btn) {
                clearActive();
                btn.classList.remove('btn-outline-secondary');
                btn.classList.add('btn-primary');

                try {
                    const resp = await fetch(`@Url.Action("ByDate", "Schedule")?date=${dateStr}`);
                    if (!resp.ok) {
                        container.innerHTML = '<div class="alert">Помилка завантаження</div>';
                        return;
                    }
                    const html = await resp.text();
                    container.innerHTML = html;
                } catch (e) {
                    container.innerHTML = '<div class="alert">Помилка завантаження (мережа)</div>';
                }
            }

            dateButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const dateStr = btn.getAttribute('data-date');
                    loadForDate(dateStr, btn);
                });
            });
        })();
    </script>
}
